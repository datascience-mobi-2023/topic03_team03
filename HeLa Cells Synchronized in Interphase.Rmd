---
title: "Topic 3: Proteome-wide Screen for RNA-dependent Proteins; Subtopic 3: HeLa synchronized in Interphase"
author: "Hannah, Johann, Kira, Viktor"
date: "2023-04-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Topic 3: Proteome-wide Screen for RNA-dependent Proteins

#### Subtopic 3: HeLa Cells Synchronized in Interphase

First, we will load the dataset containing the mass spectrometry data from HeLa cells synchronized in interphase:

```{r}
RDeeP_HeLa_Interphase = read.csv("https://www.dropbox.com/s/nm9bgsyg7cv6wu1/RDeeP_HeLa_Interphase.csv?dl=1", header=TRUE, row.names=1, sep = ";")
head(RDeeP_HeLa_Interphase)
```

Are there any missing values in the dataset?

```{r}
sum(is.na(RDeeP_HeLa_Interphase))
```

Are there any rows that only contain zeros?

```{r}
which(rowSums(RDeeP_HeLa_Interphase)==0)
```

#### 1.1 Split Dataset into Control and RNase

We can also split the dataset into two seperate datasets that contain the Control and RNase values:

```{r}
RDeeP_HeLa_Interphase_Ctrl = as.data.frame(
                             # Diese Matrix speichern wir noch als Dataframe
  matrix(
  # Aus dem großen Vektor, den wir mit "unlist" erstellt haben (mit 531450 Einträgen), machen wir eine Matrix mit      7086 Zeilen und 75 Spalten
    
    unlist(
    # Da die untere Schleife einen Dataframe erstellt mit 75 Spalten und drei Zeilen (jede Zelle enthält einen           Vektor, der einer Spalte im originalen Dataframe entspricht), müssen wir aus diesem Dataframe einen einzigen         großen Vektor mit allen Proteineinträgen generieren (das macht der Befehl "unlist")
      
      sapply(seq(0,144,6), function(n) {RDeeP_HeLa_Interphase[,c(1,2,3)+c(n,n,n)]})), 
      # Schleife, die alle Spalten der Control Samples aus dem Dataframe "RDeep_HeLa_Interphase" in Dreier-Grüppchen       (jeweils die drei Replikate pro Fraktion) nacheinander auswählt
    
    nrow=7086, ncol=75))

# Hier werden dem neu erstellten Control Dataframe die Zeilen und Spaltennamen des originalen Dataframes zugeordnet (nutzt die gleiche Schleife zum Auswählen der Control Spalten wie oben)
colnames(RDeeP_HeLa_Interphase_Ctrl) = as.vector(unlist(sapply(seq(0,144,6), function(n) {colnames(RDeeP_HeLa_Interphase[,c(1,2,3)+c(n,n,n)])})))

rownames(RDeeP_HeLa_Interphase_Ctrl) = rownames(RDeeP_HeLa_Interphase)

# Analoges Vorgehen für RNase wie Control, nur, dass sich die Startposition zum Auswählen verändert
RDeeP_HeLa_Interphase_RNase = as.data.frame(matrix(unlist(sapply(seq(0,144,6), function(n) {RDeeP_HeLa_Interphase[,c(4,5,6)+c(n,n,n)]})), nrow=7086, ncol=75))

colnames(RDeeP_HeLa_Interphase_RNase) = as.vector(unlist(sapply(seq(0,144,6), function(n) {colnames(RDeeP_HeLa_Interphase[,c(4,5,6)+c(n,n,n)])})))

rownames(RDeeP_HeLa_Interphase_RNase) = rownames(RDeeP_HeLa_Interphase)
```

#### 1.2 NA Values and Zero Rows
```{r}
## Überprüfen welche Reihen in den Datasets nur Nullen enthalten

which(rowSums(RDeeP_HeLa_Interphase_Ctrl)==0)
which(rowSums(RDeeP_HeLa_Interphase_RNase)==0)

## Löschen der Nullreihen im Controldataset

RDeeP_HeLa_Interphase_Ctrl <- RDeeP_HeLa_Interphase_Ctrl[!(rownames(RDeeP_HeLa_Interphase_Ctrl)%in% c("FHOD3_HUMAN","P210L_HUMAN","PKD1_HUMAN","TGM7_HUMAN","KIF1A_HUMAN")),]

##Löschen der Nullreihen im RNase-Dataset

RDeeP_HeLa_Interphase_RNase <- RDeeP_HeLa_Interphase_RNase[!(rownames(RDeeP_HeLa_Interphase_RNase) %in% c("FHOD3_HUMAN","P210L_HUMAN","PKD1_HUMAN","TGM7_HUMAN", "KIF1A_HUMAN")),]
```

#### 1.4 Mean of Replicates

```{r}
Mean_Ctrl = as.data.frame(
            # Abspeichern als Dataframe
  
  sapply(seq(0,72,3), function(i) {
  # Äußere Schleife, die zum Auswählen der drei Replikate pro Fraktion da ist (Startvektor c(1,2,3) wird jeweils um c(3,3,3) erhöht) 
    
    apply(RDeeP_HeLa_Interphase_Ctrl[,c(1,2,3)+c(i,i,i)], 1, function(x) {mean(x)})
    # Innere Schleife, die nachdem die drei Replikate für eine Fraktion ausgewählt wurden, über alle Zeilen dieser       Replikate den Mittelwert berechnet
    
    }))

# Erstellen neuer Spaltennamen für den Mean_Ctrl Dataframe. Der Befehl "paste" erlaubt es, sowohl Text als auch Befehle als ein String zu haben (sep="", bedeutet, dass die Elemente durch kein Leerzeichen voneinander getrennt werden sollen)
colnames(Mean_Ctrl) = paste("Fraction",seq(1,25,1),"_Ctrl_Mean",sep="")

# Analoges Vorgehen für den RNase Dataframe
Mean_RNase = as.data.frame(
  sapply(seq(0,72,3), function(i) {
    apply(RDeeP_HeLa_Interphase_RNase[,c(1,2,3)+c(i,i,i)], 1, function(x) {mean(x)})
    }))

colnames(Mean_RNase) = paste("Fraction",seq(1,25,1),"_RNase_Mean",sep="")
```


#### 1.5 Normalize Rows to 100

This will be done for the Control and RNase Datasets separately:

```{r}
Ctrl_Norm_100 = as.data.frame(sapply(RDeeP_HeLa_Interphase_Ctrl, function(i){(i/apply(RDeeP_HeLa_Interphase_Ctrl,1,sum))*100}))

RNase_Norm_100 = as.data.frame(sapply(RDeeP_HeLa_Interphase_RNase, function(i){(i/apply(RDeeP_HeLa_Interphase_RNase,1,sum))*100}))
```

#### 1.7 Data Exploration, First Graphical Representations

##### Without Normalization
```{r}
plot(1:25, Mean_Ctrl[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CTCF_HUMAN")
lines(1:25, Mean_RNase[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
```
```{r}
plot(1:25, Mean_Ctrl[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CY24A_HUMAN")
lines(1:25, Mean_RNase[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
```

##### With Normailzation 
```{r}
Mean_Ctrl_Norm_100 = as.data.frame(sapply(Mean_Ctrl, function(i){(i/apply(Mean_Ctrl,1,sum))*100}))

Mean_RNase_Norm_100 = as.data.frame(sapply(Mean_RNase, function(i){(i/apply(Mean_RNase,1,sum))*100}))
```

```{r}
plot(1:25, Mean_Ctrl_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CTCF_HUMAN Normalized", ylim=c(0,25))
lines(1:25, Mean_RNase_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
```

```{r}
plot(1:25, Mean_Ctrl_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CY24A_HUMAN Normailzed", ylim=c(0,18))
lines(1:25, Mean_RNase_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
```

### Determination of Maxima

#### 2.1 Smoothing the Data

We will smooth out the Data by calculating the mean value for each fraction within a defined neighborhood (n):
```{r}
# n = 1 (left and right neighbor)
Mean_Ctrl_Norm_100_Smooth = 
  as.data.frame(
cbind((Mean_Ctrl_Norm_100[,1]+Mean_Ctrl_Norm_100[,2])/2,
      sapply(seq(0,22,1), function(i) {apply(Mean_Ctrl_Norm_100[,c(1,2,3)+c(i,i,i)], 1, function(x) {mean(x)})}), 
      (Mean_Ctrl_Norm_100[,24]+Mean_Ctrl_Norm_100[,25])/2)
)

colnames(Mean_Ctrl_Norm_100_Smooth) = colnames(Mean_Ctrl_Norm_100)


Mean_RNase_Norm_100_Smooth = 
  as.data.frame(
cbind(Mean_RNase_Norm_100[,1],
      sapply(seq(0,22,1), function(i) {apply(Mean_RNase_Norm_100[,c(1,2,3)+c(i,i,i)], 1, function(x) {mean(x)})}), 
      Mean_RNase_Norm_100[,25])
)

colnames(Mean_RNase_Norm_100_Smooth) = colnames(Mean_RNase_Norm_100)
```

Now let us explore how this smoothing effects the data distribution:
```{r}
plot(1:25, Mean_Ctrl_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CTCF_HUMAN Normalized", ylim=c(0,25))
lines(1:25, Mean_RNase_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)

plot(1:25, Mean_Ctrl_Norm_100_Smooth[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CTCF_HUMAN Normalized and Smoothed", ylim=c(0,25))
lines(1:25, Mean_RNase_Norm_100_Smooth[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
```

```{r}
plot(1:25, Mean_Ctrl_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CY24A_HUMAN Normailzed", ylim=c(0,18))
lines(1:25, Mean_RNase_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)

plot(1:25, Mean_Ctrl_Norm_100_Smooth[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CY24A_HUMAN Normailzed and Smoothed", ylim=c(0,18))
lines(1:25, Mean_RNase_Norm_100_Smooth[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
```

#### 2.2 Determination of Global and Local Maxima

##### Global Maxima

Let us first start with the global maxima: we want a code that tells us the global maximum fraction position for each gene and condition (Control and RNase)
```{r}
Mean_Ctrl_Gbl_Max = as.matrix(sapply(seq(1,7081,1),function(i) {which(Mean_Ctrl_Norm_100_Smooth[i,] == max(Mean_Ctrl_Norm_100_Smooth[i,]))}))

# If 2 fraction positions contain the maximum protein amount, we determine the mean of these 2 fraction positions
Mean_Ctrl_Gbl_Max[which(sapply(seq(1,7081,1),function(i) {length(which(Mean_Ctrl_Norm_100_Smooth[i,] == max(Mean_Ctrl_Norm_100_Smooth[i,]) ))}) == 2),1] = apply(matrix(unlist(Mean_Ctrl_Gbl_Max[which(sapply(seq(1,7081,1),function(i) {length(which(Mean_Ctrl_Norm_100_Smooth[i,] == max(Mean_Ctrl_Norm_100_Smooth[i,]) ))}) == 2),1]), ncol=2, byrow=T), 1, function(x) {mean(x)})

# If 3 fraction positions contain the maximum protein amount, we determine the mean of these 3 fraction positions
Mean_Ctrl_Gbl_Max[which(sapply(seq(1,7081,1),function(i) {length(which(Mean_Ctrl_Norm_100_Smooth[i,] == max(Mean_Ctrl_Norm_100_Smooth[i,]) ))}) == 3),1] = apply(matrix(unlist(Mean_Ctrl_Gbl_Max[which(sapply(seq(1,7081,1),function(i) {length(which(Mean_Ctrl_Norm_100_Smooth[i,] == max(Mean_Ctrl_Norm_100_Smooth[i,]) ))}) == 3),1]), ncol=3, byrow=T), 1, function(x) {mean(x)})

colnames(Mean_Ctrl_Gbl_Max) = c("Ctrl_Gbl_Max")
rownames(Mean_Ctrl_Gbl_Max) = rownames(Mean_Ctrl_Norm_100_Smooth)



Mean_RNase_Gbl_Max = as.matrix(sapply(seq(1,7081,1),function(i) {which(Mean_RNase_Norm_100_Smooth[i,] == max(Mean_RNase_Norm_100_Smooth[i,]))}))

Mean_RNase_Gbl_Max[which(sapply(seq(1,7081,1),function(i) {length(which(Mean_RNase_Norm_100_Smooth[i,] == max(Mean_RNase_Norm_100_Smooth[i,]) ))}) == 2),1] = apply(matrix(unlist(Mean_RNase_Gbl_Max[which(sapply(seq(1,7081,1),function(i) {length(which(Mean_RNase_Norm_100_Smooth[i,] == max(Mean_RNase_Norm_100_Smooth[i,]) ))}) == 2),1]), ncol=2, byrow=T), 1, function(x) {mean(x)})

Mean_RNase_Gbl_Max[which(sapply(seq(1,7081,1),function(i) {length(which(Mean_RNase_Norm_100_Smooth[i,] == max(Mean_RNase_Norm_100_Smooth[i,]) ))}) == 3),1] = apply(matrix(unlist(Mean_RNase_Gbl_Max[which(sapply(seq(1,7081,1),function(i) {length(which(Mean_RNase_Norm_100_Smooth[i,] == max(Mean_RNase_Norm_100_Smooth[i,]) ))}) == 3),1]), ncol=3, byrow=T), 1, function(x) {mean(x)})

colnames(Mean_RNase_Gbl_Max) = c("RNase_Gbl_Max")
rownames(Mean_RNase_Gbl_Max) = rownames(Mean_RNase_Norm_100_Smooth)

Mean_Gbl_Max = cbind(Mean_Ctrl_Gbl_Max, Mean_RNase_Gbl_Max)

# length(which(unlist(Mean_Gbl_Max[,1]) == unlist(Mean_Gbl_Max[,2])))
# length(which(abs(unlist(Mean_Gbl_Max[,1])-unlist(Mean_Gbl_Max[,2])) >= 2))
```

Lets see if it worked!


```{r}
gene.name=c("CTCF_HUMAN")

plot(1:25, Mean_Ctrl_Norm_100_Smooth[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main=paste(paste(gene.name, "(Normalized and Smoothed)")), ylim=c(0,25))

abline(v=Mean_Ctrl_Gbl_Max[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],lwd=3,col="green",lty=3)

lines(1:25, Mean_RNase_Norm_100_Smooth[which(rownames(RDeeP_HeLa_Interphase)==gene.name),], type="l",lwd=3,col="red")

abline(v=Mean_RNase_Gbl_Max[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],lwd=3,col="red",lty=3)

grid()

legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
rm(gene.name)
```


```{r}
gene.name=c("CY24A_HUMAN")

plot(1:25, Mean_Ctrl_Norm_100_Smooth[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main=paste(paste(gene.name, "(Normalized and Smoothed)")), ylim=c(0,25))

abline(v=Mean_Ctrl_Gbl_Max[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],lwd=3,col="green",lty=3)

lines(1:25, Mean_RNase_Norm_100_Smooth[which(rownames(RDeeP_HeLa_Interphase)==gene.name),], type="l",lwd=3,col="red")

abline(v=Mean_RNase_Gbl_Max[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],lwd=3,col="red",lty=3)

grid()

legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
rm(gene.name)
```
But Smoothing sometimes changes the position of the maxima!!!!

```{r}
gene.name=c("RS29_HUMAN")

plot(1:25, Mean_Ctrl_Norm_100_Smooth[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main=paste(paste(gene.name, "(Normalized and Smoothed)")), ylim=c(0,25))

abline(v=Mean_Ctrl_Gbl_Max[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],lwd=3,col="green",lty=3)

lines(1:25, Mean_RNase_Norm_100_Smooth[which(rownames(RDeeP_HeLa_Interphase)==gene.name),], type="l",lwd=3,col="red")

abline(v=Mean_RNase_Gbl_Max[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],lwd=3,col="red",lty=3)

grid()

legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)


plot(1:25, Mean_Ctrl_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main=paste(paste(gene.name, "(Normalized and Smoothed)")), ylim=c(0,25))

abline(v=Mean_Ctrl_Gbl_Max[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],lwd=3,col="green",lty=3)

lines(1:25, Mean_RNase_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==gene.name),], type="l",lwd=3,col="red")

abline(v=Mean_RNase_Gbl_Max[which(rownames(RDeeP_HeLa_Interphase)==gene.name),],lwd=3,col="red",lty=3)

grid()

legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
rm(gene.name)
```
Another Example, where the peak positions would be at the same fraction position in the unsmoothen data but differ in the smoothen data:
```{r}
gene.name="XXLT1_HUMAN"

plot(1:25, Mean_Ctrl_Norm_100_Smooth[which(rownames(Mean_Ctrl)==gene.name),],type="l",lwd=3,col="green",xlab="Protein Fractions",ylab="Relative Protein Amount",main=paste(paste(gene.name, "(Normalized and Smoothed)")), ylim=c(0,max(max(Mean_Ctrl_Norm_100_Smooth[which(rownames(Mean_Ctrl)==gene.name),]), max(Mean_RNase_Norm_100_Smooth[which(rownames(Mean_Ctrl)==gene.name),]))+3))

abline(v=Mean_Ctrl_Gbl_Max[which(rownames(Mean_Ctrl)==gene.name),],lwd=3,col="green",lty=3)

lines(1:25, Mean_RNase_Norm_100_Smooth[which(rownames(Mean_RNase)==gene.name),], type="l",lwd=3,col="red")

abline(v=Mean_RNase_Gbl_Max[which(rownames(Mean_RNase)==gene.name),],lwd=3,col="red",lty=3)

grid()

legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)


plot(1:25, Mean_Ctrl_Norm_100[which(rownames(Mean_Ctrl)==gene.name),],type="l",lwd=3,col="green",xlab="Protein Fractions",ylab="Relative Protein Amount",main=paste(paste(gene.name, "(Normalized)")), ylim=c(0,max(max(Mean_Ctrl_Norm_100[which(rownames(Mean_Ctrl)==gene.name),]), max(Mean_RNase_Norm_100[which(rownames(Mean_Ctrl)==gene.name),]))+3))

abline(v=Mean_Ctrl_Gbl_Max[which(rownames(Mean_Ctrl)==gene.name),],lwd=3,col="green",lty=3)

lines(1:25, Mean_RNase_Norm_100[which(rownames(Mean_RNase)==gene.name),], type="l",lwd=3,col="red")

abline(v=Mean_RNase_Gbl_Max[which(rownames(Mean_RNase)==gene.name),],lwd=3,col="red",lty=3)

grid()

legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)

rm(gene.name)
```
##### Local Maxima

We will now calculate the fraction positions of all local maxima for every gene and condition. But what defines a local maximum? 
We will look at the protein amount for a neighborhood of n = 2 for each fraction positions (for local maxima at the edges we will use slightly different criteria):

X X [X] X X 

We will then compare the protein amount in that fraction position to the protein amount for the 4 fraction positions around that fraction position and ask the question: Is the protein amount in that fraction greater or equal to its neighborhood? If TRUE then we define that fraction position as a local maximum.
```{r}
Mean_Ctrl_Loc_Max = as.data.frame(matrix(NA, nrow = 7081, ncol = 25))

Fra.Pos = sapply(seq(0,20,1), function(i) {which(seq(2*7081+1,3*7081,1) %in% which(apply(Mean_Ctrl_Norm_100_Smooth[,c(1:5)+c(i,i,i,i,i)], 1, function(x) {max(x)}) == Mean_Ctrl_Norm_100_Smooth[,c(1:5)+c(i,i,i,i,i)] & apply(Mean_Ctrl_Norm_100_Smooth[,c(1:5)+c(i,i,i,i,i)], 1, function(x) {max(x)}) != 0))})

Mean_Ctrl_Loc_Max[Fra.Pos[[1]],3]=3
Mean_Ctrl_Loc_Max[Fra.Pos[[2]],4]=4
Mean_Ctrl_Loc_Max[Fra.Pos[[3]],5]=5
Mean_Ctrl_Loc_Max[Fra.Pos[[4]],6]=6
Mean_Ctrl_Loc_Max[Fra.Pos[[5]],7]=7
Mean_Ctrl_Loc_Max[Fra.Pos[[6]],8]=8
Mean_Ctrl_Loc_Max[Fra.Pos[[7]],9]=9
Mean_Ctrl_Loc_Max[Fra.Pos[[8]],10]=10
Mean_Ctrl_Loc_Max[Fra.Pos[[9]],11]=11
Mean_Ctrl_Loc_Max[Fra.Pos[[10]],12]=12
Mean_Ctrl_Loc_Max[Fra.Pos[[11]],13]=13
Mean_Ctrl_Loc_Max[Fra.Pos[[12]],14]=14
Mean_Ctrl_Loc_Max[Fra.Pos[[13]],15]=15
Mean_Ctrl_Loc_Max[Fra.Pos[[14]],16]=16
Mean_Ctrl_Loc_Max[Fra.Pos[[15]],17]=17
Mean_Ctrl_Loc_Max[Fra.Pos[[16]],18]=18
Mean_Ctrl_Loc_Max[Fra.Pos[[17]],19]=19
Mean_Ctrl_Loc_Max[Fra.Pos[[18]],20]=20
Mean_Ctrl_Loc_Max[Fra.Pos[[19]],21]=21
Mean_Ctrl_Loc_Max[Fra.Pos[[20]],22]=22
Mean_Ctrl_Loc_Max[Fra.Pos[[21]],23]=23

rownames(Mean_Ctrl_Loc_Max) = rownames(Mean_Ctrl)
colnames(Mean_Ctrl_Loc_Max) = colnames(Mean_Ctrl)



Mean_RNase_Loc_Max = as.data.frame(matrix(NA, nrow = 7081, ncol = 25))

Fra.Pos = sapply(seq(0,20,1), function(i) {which(seq(2*7081+1,3*7081,1) %in% which(apply(Mean_RNase_Norm_100_Smooth[,c(1:5)+c(i,i,i,i,i)], 1, function(x) {max(x)}) == Mean_RNase_Norm_100_Smooth[,c(1:5)+c(i,i,i,i,i)] & apply(Mean_RNase_Norm_100_Smooth[,c(1:5)+c(i,i,i,i,i)], 1, function(x) {max(x)}) != 0))})

Mean_RNase_Loc_Max[Fra.Pos[[1]],3]=3
Mean_RNase_Loc_Max[Fra.Pos[[2]],4]=4
Mean_RNase_Loc_Max[Fra.Pos[[3]],5]=5
Mean_RNase_Loc_Max[Fra.Pos[[4]],6]=6
Mean_RNase_Loc_Max[Fra.Pos[[5]],7]=7
Mean_RNase_Loc_Max[Fra.Pos[[6]],8]=8
Mean_RNase_Loc_Max[Fra.Pos[[7]],9]=9
Mean_RNase_Loc_Max[Fra.Pos[[8]],10]=10
Mean_RNase_Loc_Max[Fra.Pos[[9]],11]=11
Mean_RNase_Loc_Max[Fra.Pos[[10]],12]=12
Mean_RNase_Loc_Max[Fra.Pos[[11]],13]=13
Mean_RNase_Loc_Max[Fra.Pos[[12]],14]=14
Mean_RNase_Loc_Max[Fra.Pos[[13]],15]=15
Mean_RNase_Loc_Max[Fra.Pos[[14]],16]=16
Mean_RNase_Loc_Max[Fra.Pos[[15]],17]=17
Mean_RNase_Loc_Max[Fra.Pos[[16]],18]=18
Mean_RNase_Loc_Max[Fra.Pos[[17]],19]=19
Mean_RNase_Loc_Max[Fra.Pos[[18]],20]=20
Mean_RNase_Loc_Max[Fra.Pos[[19]],21]=21
Mean_RNase_Loc_Max[Fra.Pos[[20]],22]=22
Mean_RNase_Loc_Max[Fra.Pos[[21]],23]=23

rownames(Mean_RNase_Loc_Max) = rownames(Mean_RNase)
colnames(Mean_RNase_Loc_Max) = colnames(Mean_RNase)


## Edge Cases:

# Fraction 1
Mean_Ctrl_Loc_Max[which(Mean_Ctrl_Norm_100_Smooth[,1] >= Mean_Ctrl_Norm_100_Smooth[,2] & Mean_Ctrl_Norm_100_Smooth[,1] >= Mean_Ctrl_Norm_100_Smooth[,3] & Mean_Ctrl_Norm_100_Smooth[,1] != 0),1] = 1

Mean_RNase_Loc_Max[which(Mean_RNase_Norm_100_Smooth[,1] >= Mean_RNase_Norm_100_Smooth[,2] & Mean_RNase_Norm_100_Smooth[,1] >= Mean_RNase_Norm_100_Smooth[,3] & Mean_RNase_Norm_100_Smooth[,1] != 0),1] = 1

# Fraction 2
Mean_Ctrl_Loc_Max[which(Mean_Ctrl_Norm_100_Smooth[,2] >= Mean_Ctrl_Norm_100_Smooth[,3] & Mean_Ctrl_Norm_100_Smooth[,2] >= Mean_Ctrl_Norm_100_Smooth[,4] & Mean_Ctrl_Norm_100_Smooth[,2] >= Mean_Ctrl_Norm_100_Smooth[,1] & Mean_Ctrl_Norm_100_Smooth[,1] != 0), 2] = 2

Mean_RNase_Loc_Max[which(Mean_RNase_Norm_100_Smooth[,2] >= Mean_RNase_Norm_100_Smooth[,3] & Mean_RNase_Norm_100_Smooth[,2] >= Mean_RNase_Norm_100_Smooth[,4] & Mean_RNase_Norm_100_Smooth[,2] >= Mean_RNase_Norm_100_Smooth[,1] & Mean_RNase_Norm_100_Smooth[,1] != 0), 2] = 2

# Fraction 25
Mean_Ctrl_Loc_Max[which(Mean_Ctrl_Norm_100_Smooth[,25] >= Mean_Ctrl_Norm_100_Smooth[,24] & Mean_Ctrl_Norm_100_Smooth[,25] >= Mean_Ctrl_Norm_100_Smooth[,23] & Mean_Ctrl_Norm_100_Smooth[,25] != 0), 25] = 25

Mean_RNase_Loc_Max[which(Mean_RNase_Norm_100_Smooth[,25] >= Mean_RNase_Norm_100_Smooth[,24] & Mean_RNase_Norm_100_Smooth[,25] >= Mean_RNase_Norm_100_Smooth[,23] & Mean_RNase_Norm_100_Smooth[,25] != 0), 25] = 25

# Fraction 24
Mean_Ctrl_Loc_Max[which(Mean_Ctrl_Norm_100_Smooth[,24] >= Mean_Ctrl_Norm_100_Smooth[,23] & Mean_Ctrl_Norm_100_Smooth[,24] >= Mean_Ctrl_Norm_100_Smooth[,22] & Mean_Ctrl_Norm_100_Smooth[,24] >= Mean_Ctrl_Norm_100_Smooth[,25] & Mean_Ctrl_Norm_100_Smooth[,24] != 0), 24] = 24

Mean_RNase_Loc_Max[which(Mean_RNase_Norm_100_Smooth[,24] >= Mean_RNase_Norm_100_Smooth[,23] & Mean_RNase_Norm_100_Smooth[,24] >= Mean_RNase_Norm_100_Smooth[,22] & Mean_RNase_Norm_100_Smooth[,24] >= Mean_RNase_Norm_100_Smooth[,25] & Mean_RNase_Norm_100_Smooth[,24] != 0), 24] = 24


## Removal of Global Maxima in Local Maxima Datasets (also removes all double and triple global maxima!!!)

Crtl_Mask = matrix(1, nrow = 7081*25, ncol = 1)

Crtl_Mask[which(apply(Mean_Ctrl_Norm_100_Smooth, 1, function(x) {max(x)}) == Mean_Ctrl_Norm_100_Smooth)] = NA

Crtl_Mask = as.data.frame(matrix(unlist(Crtl_Mask), nrow=7081, ncol=25))

Mean_Ctrl_Loc_Max = Mean_Ctrl_Loc_Max * Crtl_Mask

rm(Crtl_Mask)



RNase_Mask = matrix(1, nrow = 7081*25, ncol = 1)

RNase_Mask[which(apply(Mean_RNase_Norm_100_Smooth, 1, function(x) {max(x)}) == Mean_RNase_Norm_100_Smooth)] = NA

RNase_Mask = as.data.frame(matrix(unlist(RNase_Mask), nrow=7081, ncol=25))

Mean_RNase_Loc_Max = Mean_RNase_Loc_Max * RNase_Mask

rm(RNase_Mask)


## Combine double and triple peaks into single peaks

# Double peaks
Fra.Pos = sapply(seq(0,21,1), function(i) {which(!(is.na(Mean_Ctrl_Loc_Max[,c(2)+c(i)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(3)+c(i)])) & !(!(is.na(Mean_Ctrl_Loc_Max[,c(2)+c(i)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(3)+c(i)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(4)+c(i)]))) & !(!(is.na(Mean_Ctrl_Loc_Max[,c(1)+c(i)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(2)+c(i)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(3)+c(i)]))))})

Mean_Ctrl_Loc_Max[Fra.Pos[[1]],2]=2.5
Mean_Ctrl_Loc_Max[Fra.Pos[[1]],3]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[2]],3]=3.5
Mean_Ctrl_Loc_Max[Fra.Pos[[2]],4]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[3]],4]=4.5
Mean_Ctrl_Loc_Max[Fra.Pos[[3]],4]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[4]],5]=5.5
Mean_Ctrl_Loc_Max[Fra.Pos[[4]],6]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[5]],6]=6.5
Mean_Ctrl_Loc_Max[Fra.Pos[[5]],7]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[6]],7]=7.5
Mean_Ctrl_Loc_Max[Fra.Pos[[6]],8]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[7]],8]=8.5
Mean_Ctrl_Loc_Max[Fra.Pos[[7]],9]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[8]],9]=9.5
Mean_Ctrl_Loc_Max[Fra.Pos[[8]],10]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[9]],10]=10.5
Mean_Ctrl_Loc_Max[Fra.Pos[[9]],11]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[10]],11]=11.5
Mean_Ctrl_Loc_Max[Fra.Pos[[10]],12]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[11]],12]=12.5
Mean_Ctrl_Loc_Max[Fra.Pos[[11]],13]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[12]],13]=13.5
Mean_Ctrl_Loc_Max[Fra.Pos[[12]],14]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[13]],14]=14.5
Mean_Ctrl_Loc_Max[Fra.Pos[[13]],15]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[14]],15]=15.5
Mean_Ctrl_Loc_Max[Fra.Pos[[14]],16]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[15]],16]=16.5
Mean_Ctrl_Loc_Max[Fra.Pos[[15]],17]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[16]],17]=17.5
Mean_Ctrl_Loc_Max[Fra.Pos[[16]],18]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[17]],18]=18.5
Mean_Ctrl_Loc_Max[Fra.Pos[[17]],19]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[18]],19]=19.5
Mean_Ctrl_Loc_Max[Fra.Pos[[18]],20]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[19]],20]=20.5
Mean_Ctrl_Loc_Max[Fra.Pos[[19]],21]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[20]],21]=21.5
Mean_Ctrl_Loc_Max[Fra.Pos[[20]],22]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[21]],22]=22.5
Mean_Ctrl_Loc_Max[Fra.Pos[[21]],23]=NA
Mean_Ctrl_Loc_Max[Fra.Pos[[22]],23]=23.5
Mean_Ctrl_Loc_Max[Fra.Pos[[22]],24]=NA

# Edge Cases (not necessary in this case)

# Fra.Pos = which(!(is.na(Mean_Ctrl_Loc_Max[,c(1)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(2)])) & !(!(is.na(Mean_Ctrl_Loc_Max[,c(1)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(2)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(3)]))))

# Mean_Ctrl_Loc_Max[Fra.Pos[[1]],1]=1.5
# Mean_Ctrl_Loc_Max[Fra.Pos[[1]],2]=NA

# Fra.Pos = which(!(is.na(Mean_Ctrl_Loc_Max[,c(24)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(25)])) & !(!(is.na(Mean_Ctrl_Loc_Max[,c(23)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(24)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(25)]))))

# Mean_Ctrl_Loc_Max[Fra.Pos[[1]],24]=24.5
# Mean_Ctrl_Loc_Max[Fra.Pos[[1]],25]=NA


Fra.Pos = sapply(seq(0,21,1), function(i) {which(!(is.na(Mean_RNase_Loc_Max[,c(2)+c(i)])) & !(is.na(Mean_RNase_Loc_Max[,c(3)+c(i)])) & !(!(is.na(Mean_RNase_Loc_Max[,c(2)+c(i)])) & !(is.na(Mean_RNase_Loc_Max[,c(3)+c(i)])) & !(is.na(Mean_RNase_Loc_Max[,c(4)+c(i)]))) & !(!(is.na(Mean_RNase_Loc_Max[,c(1)+c(i)])) & !(is.na(Mean_RNase_Loc_Max[,c(2)+c(i)])) & !(is.na(Mean_RNase_Loc_Max[,c(3)+c(i)]))))})

Mean_RNase_Loc_Max[Fra.Pos[[1]],2]=2.5
Mean_RNase_Loc_Max[Fra.Pos[[1]],3]=NA
Mean_RNase_Loc_Max[Fra.Pos[[2]],3]=3.5
Mean_RNase_Loc_Max[Fra.Pos[[2]],4]=NA
Mean_RNase_Loc_Max[Fra.Pos[[3]],4]=4.5
Mean_RNase_Loc_Max[Fra.Pos[[3]],4]=NA
Mean_RNase_Loc_Max[Fra.Pos[[4]],5]=5.5
Mean_RNase_Loc_Max[Fra.Pos[[4]],6]=NA
Mean_RNase_Loc_Max[Fra.Pos[[5]],6]=6.5
Mean_RNase_Loc_Max[Fra.Pos[[5]],7]=NA
Mean_RNase_Loc_Max[Fra.Pos[[6]],7]=7.5
Mean_RNase_Loc_Max[Fra.Pos[[6]],8]=NA
Mean_RNase_Loc_Max[Fra.Pos[[7]],8]=8.5
Mean_RNase_Loc_Max[Fra.Pos[[7]],9]=NA
Mean_RNase_Loc_Max[Fra.Pos[[8]],9]=9.5
Mean_RNase_Loc_Max[Fra.Pos[[8]],10]=NA
Mean_RNase_Loc_Max[Fra.Pos[[9]],10]=10.5
Mean_RNase_Loc_Max[Fra.Pos[[9]],11]=NA
Mean_RNase_Loc_Max[Fra.Pos[[10]],11]=11.5
Mean_RNase_Loc_Max[Fra.Pos[[10]],12]=NA
Mean_RNase_Loc_Max[Fra.Pos[[11]],12]=12.5
Mean_RNase_Loc_Max[Fra.Pos[[11]],13]=NA
Mean_RNase_Loc_Max[Fra.Pos[[12]],13]=13.5
Mean_RNase_Loc_Max[Fra.Pos[[12]],14]=NA
Mean_RNase_Loc_Max[Fra.Pos[[13]],14]=14.5
Mean_RNase_Loc_Max[Fra.Pos[[13]],15]=NA
Mean_RNase_Loc_Max[Fra.Pos[[14]],15]=15.5
Mean_RNase_Loc_Max[Fra.Pos[[14]],16]=NA
Mean_RNase_Loc_Max[Fra.Pos[[15]],16]=16.5
Mean_RNase_Loc_Max[Fra.Pos[[15]],17]=NA
Mean_RNase_Loc_Max[Fra.Pos[[16]],17]=17.5
Mean_RNase_Loc_Max[Fra.Pos[[16]],18]=NA
Mean_RNase_Loc_Max[Fra.Pos[[17]],18]=18.5
Mean_RNase_Loc_Max[Fra.Pos[[17]],19]=NA
Mean_RNase_Loc_Max[Fra.Pos[[18]],19]=19.5
Mean_RNase_Loc_Max[Fra.Pos[[18]],20]=NA
Mean_RNase_Loc_Max[Fra.Pos[[19]],20]=20.5
Mean_RNase_Loc_Max[Fra.Pos[[19]],21]=NA
Mean_RNase_Loc_Max[Fra.Pos[[20]],21]=21.5
Mean_RNase_Loc_Max[Fra.Pos[[20]],22]=NA
Mean_RNase_Loc_Max[Fra.Pos[[21]],22]=22.5
Mean_RNase_Loc_Max[Fra.Pos[[21]],23]=NA
Mean_RNase_Loc_Max[Fra.Pos[[22]],23]=23.5
Mean_RNase_Loc_Max[Fra.Pos[[22]],24]=NA

# Edge Cases (not necessary in this case)

# Fra.Pos = which(!(is.na(Mean_RNase_Loc_Max[,c(1)])) & !(is.na(Mean_RNase_Loc_Max[,c(2)])) & !(!(is.na(Mean_RNase_Loc_Max[,c(1)])) & !(is.na(Mean_RNase_Loc_Max[,c(2)])) & !(is.na(Mean_RNase_Loc_Max[,c(3)]))))

# Mean_RNase_Loc_Max[Fra.Pos[[1]],1]=1.5
# Mean_RNase_Loc_Max[Fra.Pos[[1]],2]=NA

# Fra.Pos = which(!(is.na(Mean_RNase_Loc_Max[,c(24)])) & !(is.na(Mean_RNase_Loc_Max[,c(25)])) & !(!(is.na(Mean_RNase_Loc_Max[,c(23)])) & !(is.na(Mean_RNase_Loc_Max[,c(24)])) & !(is.na(Mean_RNase_Loc_Max[,c(25)]))))

# Mean_RNase_Loc_Max[Fra.Pos[[1]],24]=24.5
# Mean_RNase_Loc_Max[Fra.Pos[[1]],25]=NA



# Triple peaks
Fra.Pos = sapply(seq(0,22,1), function(i) {which(!(is.na(Mean_Ctrl_Loc_Max[,c(1)+c(i)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(2)+c(i)])) & !(is.na(Mean_Ctrl_Loc_Max[,c(3)+c(i)])))})

Mean_Ctrl_Loc_Max[Fra.Pos[[1]],1] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[1]],2] = 2
Mean_Ctrl_Loc_Max[Fra.Pos[[1]],3] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[2]],2] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[2]],3] = 3
Mean_Ctrl_Loc_Max[Fra.Pos[[2]],4] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[3]],3] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[3]],4] = 4
Mean_Ctrl_Loc_Max[Fra.Pos[[3]],5] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[4]],4] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[4]],5] = 5
Mean_Ctrl_Loc_Max[Fra.Pos[[4]],6] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[5]],5] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[5]],6] = 6
Mean_Ctrl_Loc_Max[Fra.Pos[[5]],7] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[6]],6] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[6]],7] = 7
Mean_Ctrl_Loc_Max[Fra.Pos[[6]],8] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[7]],7] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[7]],8] = 8
Mean_Ctrl_Loc_Max[Fra.Pos[[7]],9] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[8]],8] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[8]],9] = 9
Mean_Ctrl_Loc_Max[Fra.Pos[[8]],10] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[9]],9] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[9]],10] = 10
Mean_Ctrl_Loc_Max[Fra.Pos[[9]],11] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[10]],10] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[10]],11] = 11
Mean_Ctrl_Loc_Max[Fra.Pos[[10]],12] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[11]],11] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[11]],12] = 12
Mean_Ctrl_Loc_Max[Fra.Pos[[11]],13] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[12]],12] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[12]],13] = 13
Mean_Ctrl_Loc_Max[Fra.Pos[[12]],14] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[13]],13] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[13]],14] = 14
Mean_Ctrl_Loc_Max[Fra.Pos[[13]],15] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[14]],14] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[14]],15] = 15
Mean_Ctrl_Loc_Max[Fra.Pos[[14]],15] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[15]],15] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[15]],16] = 16
Mean_Ctrl_Loc_Max[Fra.Pos[[15]],17] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[16]],16] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[16]],17] = 17
Mean_Ctrl_Loc_Max[Fra.Pos[[16]],18] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[17]],17] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[17]],18] = 18
Mean_Ctrl_Loc_Max[Fra.Pos[[17]],19] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[18]],18] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[18]],19] = 19
Mean_Ctrl_Loc_Max[Fra.Pos[[18]],20] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[19]],19] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[19]],20] = 20
Mean_Ctrl_Loc_Max[Fra.Pos[[19]],21] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[20]],20] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[20]],21] = 21
Mean_Ctrl_Loc_Max[Fra.Pos[[20]],22] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[21]],21] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[21]],22] = 22
Mean_Ctrl_Loc_Max[Fra.Pos[[21]],23] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[22]],22] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[22]],23] = 23
Mean_Ctrl_Loc_Max[Fra.Pos[[22]],24] = NA

Mean_Ctrl_Loc_Max[Fra.Pos[[23]],23] = NA
Mean_Ctrl_Loc_Max[Fra.Pos[[23]],24] = 24
Mean_Ctrl_Loc_Max[Fra.Pos[[23]],25] = NA


Fra.Pos = sapply(seq(0,22,1), function(i) {which(!(is.na(Mean_RNase_Loc_Max[,c(1)+c(i)])) & !(is.na(Mean_RNase_Loc_Max[,c(2)+c(i)])) & !(is.na(Mean_RNase_Loc_Max[,c(3)+c(i)])))})

Mean_RNase_Loc_Max[Fra.Pos[[1]],1] = NA
Mean_RNase_Loc_Max[Fra.Pos[[1]],2] = 2
Mean_RNase_Loc_Max[Fra.Pos[[1]],3] = NA

Mean_RNase_Loc_Max[Fra.Pos[[2]],2] = NA
Mean_RNase_Loc_Max[Fra.Pos[[2]],3] = 3
Mean_RNase_Loc_Max[Fra.Pos[[2]],4] = NA

Mean_RNase_Loc_Max[Fra.Pos[[3]],3] = NA
Mean_RNase_Loc_Max[Fra.Pos[[3]],4] = 4
Mean_RNase_Loc_Max[Fra.Pos[[3]],5] = NA

Mean_RNase_Loc_Max[Fra.Pos[[4]],4] = NA
Mean_RNase_Loc_Max[Fra.Pos[[4]],5] = 5
Mean_RNase_Loc_Max[Fra.Pos[[4]],6] = NA

Mean_RNase_Loc_Max[Fra.Pos[[5]],5] = NA
Mean_RNase_Loc_Max[Fra.Pos[[5]],6] = 6
Mean_RNase_Loc_Max[Fra.Pos[[5]],7] = NA

Mean_RNase_Loc_Max[Fra.Pos[[6]],6] = NA
Mean_RNase_Loc_Max[Fra.Pos[[6]],7] = 7
Mean_RNase_Loc_Max[Fra.Pos[[6]],8] = NA

Mean_RNase_Loc_Max[Fra.Pos[[7]],7] = NA
Mean_RNase_Loc_Max[Fra.Pos[[7]],8] = 8
Mean_RNase_Loc_Max[Fra.Pos[[7]],9] = NA

Mean_RNase_Loc_Max[Fra.Pos[[8]],8] = NA
Mean_RNase_Loc_Max[Fra.Pos[[8]],9] = 9
Mean_RNase_Loc_Max[Fra.Pos[[8]],10] = NA

Mean_RNase_Loc_Max[Fra.Pos[[9]],9] = NA
Mean_RNase_Loc_Max[Fra.Pos[[9]],10] = 10
Mean_RNase_Loc_Max[Fra.Pos[[9]],11] = NA

Mean_RNase_Loc_Max[Fra.Pos[[10]],10] = NA
Mean_RNase_Loc_Max[Fra.Pos[[10]],11] = 11
Mean_RNase_Loc_Max[Fra.Pos[[10]],12] = NA

Mean_RNase_Loc_Max[Fra.Pos[[11]],11] = NA
Mean_RNase_Loc_Max[Fra.Pos[[11]],12] = 12
Mean_RNase_Loc_Max[Fra.Pos[[11]],13] = NA

Mean_RNase_Loc_Max[Fra.Pos[[12]],12] = NA
Mean_RNase_Loc_Max[Fra.Pos[[12]],13] = 13
Mean_RNase_Loc_Max[Fra.Pos[[12]],14] = NA

Mean_RNase_Loc_Max[Fra.Pos[[13]],13] = NA
Mean_RNase_Loc_Max[Fra.Pos[[13]],14] = 14
Mean_RNase_Loc_Max[Fra.Pos[[13]],15] = NA

Mean_RNase_Loc_Max[Fra.Pos[[14]],14] = NA
Mean_RNase_Loc_Max[Fra.Pos[[14]],15] = 15
Mean_RNase_Loc_Max[Fra.Pos[[14]],16] = NA

Mean_RNase_Loc_Max[Fra.Pos[[15]],15] = NA
Mean_RNase_Loc_Max[Fra.Pos[[15]],16] = 16
Mean_RNase_Loc_Max[Fra.Pos[[15]],17] = NA

Mean_RNase_Loc_Max[Fra.Pos[[16]],16] = NA
Mean_RNase_Loc_Max[Fra.Pos[[16]],17] = 17
Mean_RNase_Loc_Max[Fra.Pos[[16]],18] = NA

Mean_RNase_Loc_Max[Fra.Pos[[17]],17] = NA
Mean_RNase_Loc_Max[Fra.Pos[[17]],18] = 18
Mean_RNase_Loc_Max[Fra.Pos[[17]],19] = NA

Mean_RNase_Loc_Max[Fra.Pos[[18]],18] = NA
Mean_RNase_Loc_Max[Fra.Pos[[18]],19] = 19
Mean_RNase_Loc_Max[Fra.Pos[[18]],20] = NA

Mean_RNase_Loc_Max[Fra.Pos[[19]],19] = NA
Mean_RNase_Loc_Max[Fra.Pos[[19]],20] = 20
Mean_RNase_Loc_Max[Fra.Pos[[19]],21] = NA

Mean_RNase_Loc_Max[Fra.Pos[[20]],20] = NA
Mean_RNase_Loc_Max[Fra.Pos[[20]],21] = 21
Mean_RNase_Loc_Max[Fra.Pos[[20]],22] = NA

Mean_RNase_Loc_Max[Fra.Pos[[21]],21] = NA
Mean_RNase_Loc_Max[Fra.Pos[[21]],22] = 22
Mean_RNase_Loc_Max[Fra.Pos[[21]],23] = NA

Mean_RNase_Loc_Max[Fra.Pos[[22]],22] = NA
Mean_RNase_Loc_Max[Fra.Pos[[22]],23] = 23
Mean_RNase_Loc_Max[Fra.Pos[[22]],24] = NA

Mean_RNase_Loc_Max[Fra.Pos[[23]],23] = NA
Mean_RNase_Loc_Max[Fra.Pos[[23]],24] = 24
Mean_RNase_Loc_Max[Fra.Pos[[23]],25] = NA

rm(Fra.Pos)

# Noch zu beachten: was mit nicht hohen peaks (mini-peaks)? 
```


#### 2.Extra: Automatic Graph Plotter
```{r}
# RL32_HUMAN
# ABCA1_HUMAN (gut für triple peaks to single peak)
gene.name="RL32_HUMAN"

par(mar=c(5, 4, 4, 7), xpd=F)

plot(1:25, Mean_Ctrl_Norm_100_Smooth[which(rownames(Mean_Ctrl)==gene.name),],type="l",lwd=3,col="green",xlab="Protein Fractions",ylab="Relative Protein Amount",main=paste(paste(gene.name, "(Normalized and Smoothed)")), ylim=c(0,max(max(Mean_Ctrl_Norm_100_Smooth[which(rownames(Mean_Ctrl)==gene.name),]), max(Mean_RNase_Norm_100_Smooth[which(rownames(Mean_Ctrl)==gene.name),]))+3))

grid()

segments(unlist(Mean_Ctrl_Gbl_Max[which(rownames(Mean_Ctrl)==gene.name),]), 
         -1, 
         unlist(Mean_Ctrl_Gbl_Max[which(rownames(Mean_Ctrl)==gene.name),]), 
         Mean_Ctrl_Norm_100_Smooth[which(rownames(Mean_Ctrl)==gene.name), unlist(Mean_Ctrl_Gbl_Max[which(rownames(Mean_Ctrl)==gene.name),])], 
         lwd=3,col="green",lty=1)

if(!is.null(unlist(Mean_Ctrl_Loc_Max[which(rownames(Mean_Ctrl)==gene.name),which(!is.na(Mean_Ctrl_Loc_Max[which(rownames(Mean_Ctrl)==gene.name),]))]))) {

segments(unlist(Mean_Ctrl_Loc_Max[which(rownames(Mean_Ctrl)==gene.name),which(!is.na(Mean_Ctrl_Loc_Max[which(rownames(Mean_Ctrl)==gene.name),]))]), 
         -1, 
         unlist(Mean_Ctrl_Loc_Max[which(rownames(Mean_Ctrl)==gene.name),which(!is.na(Mean_Ctrl_Loc_Max[which(rownames(Mean_Ctrl)==gene.name),]))]), 
         unlist(Mean_Ctrl_Norm_100_Smooth[which(rownames(Mean_Ctrl)==gene.name), which(!is.na(Mean_Ctrl_Loc_Max[which(rownames(Mean_Ctrl)==gene.name),]))]), 
         lwd=3,col="green",lty=1)}

lines(1:25, Mean_RNase_Norm_100_Smooth[which(rownames(Mean_RNase)==gene.name),], type="l",lwd=3,col="red")

segments(unlist(Mean_RNase_Gbl_Max[which(rownames(Mean_RNase)==gene.name),]), 
         -1, 
         unlist(Mean_RNase_Gbl_Max[which(rownames(Mean_RNase)==gene.name),]), 
         Mean_RNase_Norm_100_Smooth[which(rownames(Mean_RNase)==gene.name), unlist(Mean_RNase_Gbl_Max[which(rownames(Mean_RNase)==gene.name),])], 
         lwd=3,col="red",lty=3)

if(!is.null(unlist(Mean_RNase_Loc_Max[which(rownames(Mean_RNase)==gene.name),which(!is.na(Mean_RNase_Loc_Max[which(rownames(Mean_RNase)==gene.name),]))]))) {

segments(unlist(Mean_RNase_Loc_Max[which(rownames(Mean_RNase)==gene.name),which(!is.na(Mean_RNase_Loc_Max[which(rownames(Mean_RNase)==gene.name),]))]), 
         -1, 
         unlist(Mean_RNase_Loc_Max[which(rownames(Mean_RNase)==gene.name),which(!is.na(Mean_RNase_Loc_Max[which(rownames(Mean_RNase)==gene.name),]))]), 
         unlist(Mean_RNase_Norm_100_Smooth[which(rownames(Mean_RNase)==gene.name), which(!is.na(Mean_RNase_Loc_Max[which(rownames(Mean_RNase)==gene.name),]))]), 
         lwd=3,col="red",lty=3)}

points(Mean_Ctrl_Gbl_Max[which(rownames(Mean_Ctrl)==gene.name), ], Mean_Ctrl_Norm_100_Smooth[which(rownames(Mean_Ctrl)==gene.name),unlist(Mean_Ctrl_Gbl_Max[which(rownames(Mean_Ctrl)==gene.name),])], pch=21, col="black", bg="green", cex=1.5)

points(Mean_Ctrl_Loc_Max[which(rownames(Mean_Ctrl)==gene.name),which(!is.na(Mean_Ctrl_Loc_Max[which(rownames(Mean_Ctrl)==gene.name),]))], Mean_Ctrl_Norm_100_Smooth[which(rownames(Mean_Ctrl)==gene.name), which(!is.na(Mean_Ctrl_Loc_Max[which(rownames(Mean_Ctrl)==gene.name),]))], pch=24, col="black", bg="green", cex=1.2)

points(Mean_RNase_Gbl_Max[which(rownames(Mean_RNase)==gene.name), ], Mean_RNase_Norm_100_Smooth[which(rownames(Mean_RNase)==gene.name),unlist(Mean_RNase_Gbl_Max[which(rownames(Mean_RNase)==gene.name),])], pch=21, col="black", bg="red", cex=1.5)

points(Mean_RNase_Loc_Max[which(rownames(Mean_RNase)==gene.name),which(!is.na(Mean_RNase_Loc_Max[which(rownames(Mean_RNase)==gene.name),]))], Mean_RNase_Norm_100_Smooth[which(rownames(Mean_RNase)==gene.name), which(!is.na(Mean_RNase_Loc_Max[which(rownames(Mean_RNase)==gene.name),]))], pch=24, col="black", bg="red", cex=1.2)

par(xpd=T)

legend("topright",inset = c(-0.23,0), legend=c("Control","RNase", "Global", "Local"), pch=c(NA, NA, 21, 24), lty=c(1,1,NA,NA), col=c("green","red","black","black"), lwd = c(2,2,1.5,1.5))

rm(gene.name)
```
