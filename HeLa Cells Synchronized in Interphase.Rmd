---
title: "Topic 3: Proteome-wide Screen for RNA-dependent Proteins; Subtopic 3: HeLa synchronized in Interphase"
author: "Hannah, Johann, Kira, Viktor"
date: "2023-04-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Topic 3: Proteome-wide Screen for RNA-dependent Proteins

#### Subtopic 3: HeLa Cells Synchronized in Interphase

First, we will load the dataset containing the mass spectrometry data from HeLa cells synchronized in interphase:

```{r}
RDeeP_HeLa_Interphase = read.csv("https://www.dropbox.com/s/nm9bgsyg7cv6wu1/RDeeP_HeLa_Interphase.csv?dl=1", header=TRUE, row.names=1, sep = ";")
head(RDeeP_HeLa_Interphase)
```

Are there any missing values in the dataset?

```{r}
sum(is.na(RDeeP_HeLa_Interphase))
```

Are there any rows that only contain zeros?

```{r}
which(rowSums(RDeeP_HeLa_Interphase)==0)
```

#### 1.1 Split Dataset into Control and RNase

We can also split the dataset into two seperate datasets that contain the Control and RNase values:

```{r}
RDeeP_HeLa_Interphase_Ctrl = as.data.frame(
                             # Diese Matrix speichern wir noch als Dataframe
  matrix(
  # Aus dem großen Vektor, den wir mit "unlist" erstellt haben (mit 531450 Einträgen), machen wir eine Matrix mit      7086 Zeilen und 75 Spalten
    
    unlist(
    # Da die untere Schleife einen Dataframe erstellt mit 75 Spalten und drei Zeilen (jede Zelle enthält einen           Vektor, der einer Spalte im originalen Dataframe entspricht), müssen wir aus diesem Dataframe einen einzigen         großen Vektor mit allen Proteineinträgen generieren (das macht der Befehl "unlist")
      
      sapply(seq(0,144,6), function(n) {RDeeP_HeLa_Interphase[,c(1,2,3)+c(n,n,n)]})), 
      # Schleife, die alle Spalten der Control Samples aus dem Dataframe "RDeep_HeLa_Interphase" in Dreier-Grüppchen       (jeweils die drei Replikate pro Fraktion) nacheinander auswählt
    
    nrow=7086, ncol=75))

# Hier werden dem neu erstellten Control Dataframe die Zeilen und Spaltennamen des originalen Dataframes zugeordnet (nutzt die gleiche Schleife zum Auswählen der Control Spalten wie oben)
colnames(RDeeP_HeLa_Interphase_Ctrl) = as.vector(unlist(sapply(seq(0,144,6), function(n) {colnames(RDeeP_HeLa_Interphase[,c(1,2,3)+c(n,n,n)])})))

rownames(RDeeP_HeLa_Interphase_Ctrl) = rownames(RDeeP_HeLa_Interphase)

# Analoges Vorgehen für RNase wie Control, nur, dass sich die Startposition zum Auswählen verändert
RDeeP_HeLa_Interphase_RNase = as.data.frame(matrix(unlist(sapply(seq(0,144,6), function(n) {RDeeP_HeLa_Interphase[,c(4,5,6)+c(n,n,n)]})), nrow=7086, ncol=75))

colnames(RDeeP_HeLa_Interphase_RNase) = as.vector(unlist(sapply(seq(0,144,6), function(n) {colnames(RDeeP_HeLa_Interphase[,c(4,5,6)+c(n,n,n)])})))

rownames(RDeeP_HeLa_Interphase_RNase) = rownames(RDeeP_HeLa_Interphase)
```

#### 1.2 NA Values and Zero Rows
```{r}
## Überprüfen welche Reihen in den Datasets nur Nullen enthalten

which(rowSums(RDeeP_HeLa_Interphase_Ctrl)==0)
which(rowSums(RDeeP_HeLa_Interphase_RNase)==0)

## Löschen der Nullreihen im Controldataset

RDeeP_HeLa_Interphase_Ctrl <- RDeeP_HeLa_Interphase_Ctrl[!(rownames(RDeeP_HeLa_Interphase_Ctrl)%in% c("FHOD3_HUMAN","P210L_HUMAN","PKD1_HUMAN","TGM7_HUMAN","KIF1A_HUMAN")),]

##Löschen der Nullreihen im RNase-Dataset

RDeeP_HeLa_Interphase_RNase <- RDeeP_HeLa_Interphase_RNase[!(rownames(RDeeP_HeLa_Interphase_RNase) %in% c("FHOD3_HUMAN","P210L_HUMAN","PKD1_HUMAN","TGM7_HUMAN", "KIF1A_HUMAN")),]
```

#### 1.4 Mean of Replicates

```{r}
Mean_Ctrl = as.data.frame(
            # Abspeichern als Dataframe
  
  sapply(seq(0,72,3), function(i) {
  # Äußere Schleife, die zum Auswählen der drei Replikate pro Fraktion da ist (Startvektor c(1,2,3) wird jeweils um c(3,3,3) erhöht) 
    
    apply(RDeeP_HeLa_Interphase_Ctrl[,c(1,2,3)+c(i,i,i)], 1, function(x) {mean(x)})
    # Innere Schleife, die nachdem die drei Replikate für eine Fraktion ausgewählt wurden, über alle Zeilen dieser       Replikate den Mittelwert berechnet
    
    }))

# Erstellen neuer Spaltennamen für den Mean_Ctrl Dataframe. Der Befehl "paste" erlaubt es, sowohl Text als auch Befehle als ein String zu haben (sep="", bedeutet, dass die Elemente durch kein Leerzeichen voneinander getrennt werden sollen)
colnames(Mean_Ctrl) = paste("Fraction",seq(1,25,1),"_Ctrl_Mean",sep="")

# Analoges Vorgehen für den RNase Dataframe
Mean_RNase = as.data.frame(
  sapply(seq(0,72,3), function(i) {
    apply(RDeeP_HeLa_Interphase_RNase[,c(1,2,3)+c(i,i,i)], 1, function(x) {mean(x)})
    }))

colnames(Mean_RNase) = paste("Fraction",seq(1,25,1),"_RNase_Mean",sep="")
```


```{r}

# calculate mean of triplicates for each fraction split into seperate datasets

M_RNase_01 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,1:3], 1, function(x) {mean(x)}))
M_RNase_02 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,4:6], 1, function(x) {mean(x)}))
M_RNase_03 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,7:9], 1, function(x) {mean(x)}))
M_RNase_04 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,10:12], 1, function(x) {mean(x)}))
M_RNase_05 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,13:15], 1, function(x) {mean(x)}))
M_RNase_06 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,16:18], 1, function(x) {mean(x)}))
M_RNase_07 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,19:21], 1, function(x) {mean(x)}))
M_RNase_08 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,22:24], 1, function(x) {mean(x)}))
M_RNase_09 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,25:27], 1, function(x) {mean(x)}))
M_RNase_10 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,28:30], 1, function(x) {mean(x)}))
M_RNase_11 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,31:33], 1, function(x) {mean(x)}))
M_RNase_12 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,34:36], 1, function(x) {mean(x)}))
M_RNase_13 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,37:39], 1, function(x) {mean(x)}))
M_RNase_14 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,40:42], 1, function(x) {mean(x)}))
M_RNase_15 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,43:45], 1, function(x) {mean(x)}))
M_RNase_16 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,46:48], 1, function(x) {mean(x)}))
M_RNase_17 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,49:51], 1, function(x) {mean(x)}))
M_RNase_18 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,52:54], 1, function(x) {mean(x)}))
M_RNase_19 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,55:57], 1, function(x) {mean(x)}))
M_RNase_20 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,58:60], 1, function(x) {mean(x)}))
M_RNase_21 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,61:63], 1, function(x) {mean(x)}))
M_RNase_22 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,64:66], 1, function(x) {mean(x)}))
M_RNase_23 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,67:69], 1, function(x) {mean(x)}))
M_RNase_24 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,70:72], 1, function(x) {mean(x)}))
M_RNase_25 = as.data.frame(apply(RDeeP_HeLa_Interphase_RNase[,73:75], 1, function(x) {mean(x)}))

#create new dataset combining the means for all 25 fractions
Mean_RNase = cbind(M_RNase_01, M_RNase_02, M_RNase_03, M_RNase_04, M_RNase_05, M_RNase_06, M_RNase_07, M_RNase_08, M_RNase_09, M_RNase_10, M_RNase_11, M_RNase_12, M_RNase_13, M_RNase_14, M_RNase_15, M_RNase_16, M_RNase_17, M_RNase_18, M_RNase_19, M_RNase_20, M_RNase_21, M_RNase_22, M_RNase_23, M_RNase_24, M_RNase_25)

colnames(Mean_RNase) <- c('Fraction1_RNase_Mean','Fraction2_RNase_Mean','Fraction3_RNase_Mean','Fraction4_RNase_Mean','Fraction5_RNase_Mean','Fraction6_RNase_Mean','Fraction7_RNase_Mean','Fraction8_RNase_Mean','Fraction9_RNase_Mean','Fraction10_RNase_Mean','Fraction11_RNase_Mean','Fraction12_RNase_Mean','Fraction13_RNase_Mean','Fraction14_RNase_Mean','Fraction15_RNase_Mean','Fraction16_RNase_Mean','Fraction17_RNase_Mean','Fraction18_RNase_Mean','Fraction19_RNase_Mean','Fraction20_RNase_Mean','Fraction21_RNase_Mean','Fraction22_RNase_Mean','Fraction23_RNase_Mean','Fraction24_RNase_Mean','Fraction25_RNase_Mean')

#####repeat for Control dataset

# calculate mean of triplicates for each fraction split into seperate datasets
M_Ctrl_01 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,1:3], 1, function(x) {mean(x)}))
M_Ctrl_02 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,4:6], 1, function(x) {mean(x)}))
M_Ctrl_03 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,7:9], 1, function(x) {mean(x)}))
M_Ctrl_04 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,10:12], 1, function(x) {mean(x)}))
M_Ctrl_05 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,13:15], 1, function(x) {mean(x)}))
M_Ctrl_06 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,16:18], 1, function(x) {mean(x)}))
M_Ctrl_07 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,19:21], 1, function(x) {mean(x)}))
M_Ctrl_08 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,22:24], 1, function(x) {mean(x)}))
M_Ctrl_09 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,25:27], 1, function(x) {mean(x)}))
M_Ctrl_10 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,28:30], 1, function(x) {mean(x)}))
M_Ctrl_11 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,31:33], 1, function(x) {mean(x)}))
M_Ctrl_12 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,34:36], 1, function(x) {mean(x)}))
M_Ctrl_13 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,37:39], 1, function(x) {mean(x)}))
M_Ctrl_14 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,40:42], 1, function(x) {mean(x)}))
M_Ctrl_15 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,43:45], 1, function(x) {mean(x)}))
M_Ctrl_16 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,46:48], 1, function(x) {mean(x)}))
M_Ctrl_17 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,49:51], 1, function(x) {mean(x)}))
M_Ctrl_18 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,52:54], 1, function(x) {mean(x)}))
M_Ctrl_19 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,55:57], 1, function(x) {mean(x)}))
M_Ctrl_20 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,58:60], 1, function(x) {mean(x)}))
M_Ctrl_21 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,61:63], 1, function(x) {mean(x)}))
M_Ctrl_22 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,64:66], 1, function(x) {mean(x)}))
M_Ctrl_23 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,67:69], 1, function(x) {mean(x)}))
M_Ctrl_24 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,70:72], 1, function(x) {mean(x)}))
M_Ctrl_25 = as.data.frame(apply(RDeeP_HeLa_Interphase_Ctrl[,73:75], 1, function(x) {mean(x)}))

#create new dataset combining the means for all 25 fractions
Mean_Ctrl = cbind(M_Ctrl_01, M_Ctrl_02, M_Ctrl_03, M_Ctrl_04, M_Ctrl_05, M_Ctrl_06, M_Ctrl_07, M_Ctrl_08, M_Ctrl_09, M_Ctrl_10, M_Ctrl_11, M_Ctrl_12, M_Ctrl_13, M_Ctrl_14, M_Ctrl_15, M_Ctrl_16, M_Ctrl_17, M_Ctrl_18, M_Ctrl_19, M_Ctrl_20, M_Ctrl_21, M_Ctrl_22, M_Ctrl_23, M_Ctrl_24, M_Ctrl_25)

colnames(Mean_Ctrl) <- c('Fraction1_Ctrl_Mean','Fraction2_Ctrl_Mean','Fraction3_Ctrl_Mean','Fraction4_Ctrl_Mean','Fraction5_Ctrl_Mean','Fraction6_Ctrl_Mean','Fraction7_Ctrl_Mean','Fraction8_Ctrl_Mean','Fraction9_Ctrl_Mean','Fraction10_Ctrl_Mean','Fraction11_Ctrl_Mean','Fraction12_Ctrl_Mean','Fraction13_Ctrl_Mean','Fraction14_Ctrl_Mean','Fraction15_Ctrl_Mean','Fraction16_Ctrl_Mean','Fraction17_Ctrl_Mean','Fraction18_Ctrl_Mean','Fraction19_Ctrl_Mean','Fraction20_Ctrl_Mean','Fraction21_Ctrl_Mean','Fraction22_Ctrl_Mean','Fraction23_Ctrl_Mean','Fraction24_Ctrl_Mean','Fraction25_Ctrl_Mean')

#clearing the Environment of unnecessary data
remove(M_Ctrl_01, M_Ctrl_02, M_Ctrl_03, M_Ctrl_04, M_Ctrl_05, M_Ctrl_06, M_Ctrl_07, M_Ctrl_08, M_Ctrl_09, M_Ctrl_10, M_Ctrl_11, M_Ctrl_12, M_Ctrl_13, M_Ctrl_14, M_Ctrl_15, M_Ctrl_16, M_Ctrl_17, M_Ctrl_18, M_Ctrl_19, M_Ctrl_20, M_Ctrl_21, M_Ctrl_22, M_Ctrl_23, M_Ctrl_24, M_Ctrl_25,
M_RNase_01, M_RNase_02, M_RNase_03, M_RNase_04, M_RNase_05, M_RNase_06, M_RNase_07, M_RNase_08, M_RNase_09, M_RNase_10, M_RNase_11, M_RNase_12, M_RNase_13, M_RNase_14, M_RNase_15, M_RNase_16, M_RNase_17, M_RNase_18, M_RNase_19, M_RNase_20, M_RNase_21, M_RNase_22, M_RNase_23, M_RNase_24, M_RNase_25)

```

#### 1.5 Normalize Rows to 100

This will be done for the Control and RNase Datasets separately:

```{r}
Ctrl_Norm_100 = as.data.frame(sapply(RDeeP_HeLa_Interphase_Ctrl, function(i){(i/apply(RDeeP_HeLa_Interphase_Ctrl,1,sum))*100}))

RNase_Norm_100 = as.data.frame(sapply(RDeeP_HeLa_Interphase_RNase, function(i){(i/apply(RDeeP_HeLa_Interphase_RNase,1,sum))*100}))
```

#### 1.7 Data Exploration, First Graphical Representations

##### Without Normalization
```{r}
plot(1:25, Mean_Ctrl[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CTCF_HUMAN")
lines(1:25, Mean_RNase[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
```
```{r}
plot(1:25, Mean_Ctrl[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CY24A_HUMAN")
lines(1:25, Mean_RNase[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
```

##### With Normailzation 
```{r}
Mean_Ctrl_Norm_100 = as.data.frame(sapply(Mean_Ctrl, function(i){(i/apply(Mean_Ctrl,1,sum))*100}))

Mean_RNase_Norm_100 = as.data.frame(sapply(Mean_RNase, function(i){(i/apply(Mean_RNase,1,sum))*100}))
```

```{r}
plot(1:25, Mean_Ctrl_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CTCF_HUMAN Normalized", ylim=c(0,25))
lines(1:25, Mean_RNase_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CTCF_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
```

```{r}
plot(1:25, Mean_Ctrl_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),],type="l",lwd=3,col="green",xlab="Fractions",ylab="Relative Protein Amount",main="CY24A_HUMAN Normailzed", ylim=c(0,18))
lines(1:25, Mean_RNase_Norm_100[which(rownames(RDeeP_HeLa_Interphase)==c("CY24A_HUMAN")),], type="l",lwd=3,col="red")
grid()
legend("topright",legend=c("Control","RNase"),col=c("green","red"),bg="white",lwd=2)
```

